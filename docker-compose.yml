version: '2.1'
services:
  sa-api:
    build: .
    environment:
      PORT: '5000'
      SHOW_URLS: 'true'

      # Schedule
      SCHEDULE_URL: '146.148.107.218' #ipExternaFija MaquinaDenis
      SCHEDULE_PORT: '5003'
      HORARIO_ENTRY: 'horario'
      AGENDADAS_ENTRY: 'agendadas'

      # User Management
      UM_URL: '146.148.107.218' #ipExternaFija MaquinaDenis
      UM_PORT: '5005'
      COMENTARIOS_ENTRY: 'comentarios'
      CALIFICACIONES_ENTRY: 'calificaciones'
      ESTADOCUENTAS_ENTRY: 'estadocuentas'
      
      #tty: verdadero

    ports:
      - '5000:5000'
  
  # authentication
  authentication_db:
    image: nouchka/sqlite3:latest
    ports:
      - "3001:3001"
    volumes:
      - ./db/development.sqlite3

  authentication_ms:
    build: .
    command: bash -c "bundle exec rails db:create && bundle exec rails db:migrate && bundle exec rails db:setup && rm -f /authentication_ms/tmp/pids/server.pid && bundle exec rails s -p 5001 -b 0.0.0.0"
    ports:
      - "5001:5001"
    depends_on:
      - authentication_db